<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Layer &mdash; MSDTmt  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Home Module Documentation" href="../home/index.html" />
    <link rel="prev" title="Domain Layer" href="domain.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            MSDTmt
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Project Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Feature Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../splash.html">Splash Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../home.html">Home Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tm_tst.html">Trail Making Test Module Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user.html">User Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../home/index.html">Home Module Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tm_tst/index.html">Trail Making Test Module Documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">User Module Documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="presentation.html">Presentation Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="domain.html">Domain Layer</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Data Layer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#models">Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-sources">Data Sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="#repository-implementations">Repository Implementations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture.html">Feature-First Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_layers/index.html">Application Layers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MSDTmt</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Feature Modules</a></li>
          <li class="breadcrumb-item"><a href="../user.html">User Module</a></li>
      <li class="breadcrumb-item active">Data Layer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/features/user/data.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="data-layer">
<h1>Data Layer<a class="headerlink" href="#data-layer" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The Data Layer in the User module is responsible for implementing the repository interfaces defined in the domain layer. It handles the actual data operations, whether retrieving from local storage, communicating with APIs, or processing in-memory data.</p>
</section>
<section id="models">
<h2>Models<a class="headerlink" href="#models" title="Link to this heading"></a></h2>
<section id="userprofilemodel">
<h3>UserProfileModel<a class="headerlink" href="#userprofilemodel" title="Link to this heading"></a></h3>
<p>User profile model (<code class="docutils literal notranslate"><span class="pre">lib/app/features/user/data/model/user_profile_model.dart</span></code>):</p>
<ul class="simple">
<li><p>Extends UserProfile entity with serialization capabilities</p></li>
<li><p>Implements toMap() for database storage:
* Converts enum values to strings for storage
* Formats DateTime to ISO 8601 string
* Maps all fields to a database-friendly structure</p></li>
<li><p>Provides fromMap() factory for database retrieval:
* Parses stored strings back to enum values
* Converts ISO 8601 strings to DateTime objects
* Creates new UserProfileModel with parsed data</p></li>
<li><p>Includes fromEntity() factory to convert domain entity to data model</p></li>
</ul>
</section>
<section id="usertestresultlocaldatamodel">
<h3>UserTestResultLocalDataModel<a class="headerlink" href="#usertestresultlocaldatamodel" title="Link to this heading"></a></h3>
<p>Test result model (<code class="docutils literal notranslate"><span class="pre">lib/app/features/user/data/model/user_test_result_local_data_model.dart</span></code>):</p>
<ul class="simple">
<li><p>Extends UserTestLocalDataResult with database serialization</p></li>
<li><p>Implements toMap() for creating database records:
* Converts date to ISO 8601 string
* Maps all fields to database columns</p></li>
<li><p>Provides fromMap() factory for database record conversion:
* Parses date strings to DateTime
* Maps database column names to model properties</p></li>
<li><p>Includes fromEntity() factory to convert domain entity to data model</p></li>
</ul>
</section>
</section>
<section id="data-sources">
<h2>Data Sources<a class="headerlink" href="#data-sources" title="Link to this heading"></a></h2>
<section id="userprofiledatasource">
<h3>UserProfileDataSource<a class="headerlink" href="#userprofiledatasource" title="Link to this heading"></a></h3>
<p>Profile data source interface (<code class="docutils literal notranslate"><span class="pre">lib/app/features/user/data/datasources/user_profle_data_soruce.dart</span></code>):</p>
<ul class="simple">
<li><p>Defines methods for user data operations:
* <code class="docutils literal notranslate"><span class="pre">getAllProfiles()</span></code>: Retrieves all user profiles
* <code class="docutils literal notranslate"><span class="pre">getProfileByNickname()</span></code>: Finds profile by nickname
* <code class="docutils literal notranslate"><span class="pre">saveProfile()</span></code>: Saves new or updated profile
* <code class="docutils literal notranslate"><span class="pre">deleteProfileAndResultHistory()</span></code>: Removes user data
* <code class="docutils literal notranslate"><span class="pre">getAllNicknames()</span></code>: Gets list of existing nicknames
* <code class="docutils literal notranslate"><span class="pre">getAllUserId()</span></code>: Gets list of user IDs
* <code class="docutils literal notranslate"><span class="pre">setCurrentProfile()</span></code>: Sets active user profile
* <code class="docutils literal notranslate"><span class="pre">clearCurrentProfile()</span></code>: Clears active profile
* <code class="docutils literal notranslate"><span class="pre">getCurrentProfile()</span></code>: Gets current active profile</p></li>
</ul>
</section>
<section id="userprofiledatasourceimpl">
<h3>UserProfileDataSourceImpl<a class="headerlink" href="#userprofiledatasourceimpl" title="Link to this heading"></a></h3>
<p>Implementation (<code class="docutils literal notranslate"><span class="pre">lib/app/features/user/data/datasources/user_profle_data_soruce.dart</span></code>):</p>
<ul class="simple">
<li><p>Implements UserProfileDataSource interface using SQLite:
* Uses UserDatabaseHelper for database operations
* Creates and executes SQL queries for CRUD operations
* Converts between database rows and data models
* Uses LocalStorageServices for current user preferences</p></li>
</ul>
</section>
<section id="testresultlocaldatasource">
<h3>TestResultLocalDataSource<a class="headerlink" href="#testresultlocaldatasource" title="Link to this heading"></a></h3>
<p>Test result data source interface (<code class="docutils literal notranslate"><span class="pre">lib/app/features/user/data/datasources/test_result_data_soruce.dart</span></code>):</p>
<ul class="simple">
<li><p>Defines methods for test result operations:
* <code class="docutils literal notranslate"><span class="pre">getTestResultsByUserId()</span></code>: Gets results for specific user
* <code class="docutils literal notranslate"><span class="pre">getTestResultsByNickname()</span></code>: Gets results by user nickname
* <code class="docutils literal notranslate"><span class="pre">saveTestResult()</span></code>: Stores new test result
* <code class="docutils literal notranslate"><span class="pre">isReferenceCodeUsed()</span></code>: Checks for reference code duplicates</p></li>
</ul>
</section>
<section id="testresultdatasourceimpl">
<h3>TestResultDataSourceImpl<a class="headerlink" href="#testresultdatasourceimpl" title="Link to this heading"></a></h3>
<p>Implementation (<code class="docutils literal notranslate"><span class="pre">lib/app/features/user/data/datasources/test_result_data_soruce.dart</span></code>):</p>
<ul class="simple">
<li><p>Implements TestResultLocalDataSource interface:
* Uses SQLite database for result storage
* Creates SQL queries for test result operations
* Converts between database records and model objects
* Integrates with UserDatabaseHelper for database access</p></li>
</ul>
</section>
</section>
<section id="repository-implementations">
<h2>Repository Implementations<a class="headerlink" href="#repository-implementations" title="Link to this heading"></a></h2>
<section id="userprofilerepositoryimpl">
<h3>UserProfileRepositoryImpl<a class="headerlink" href="#userprofilerepositoryimpl" title="Link to this heading"></a></h3>
<p>Implementation (<code class="docutils literal notranslate"><span class="pre">lib/app/features/user/domain/repository/user_profile_repository.dart</span></code>):</p>
<ul class="simple">
<li><p>Implements UserProfileRepository interface:
* Delegates database operations to data source
* Converts between models and domain entities
* Manages profile creation and updates
* Handles current profile selection logic
* Coordinates profile and test result deletion</p></li>
</ul>
</section>
<section id="testresultlocaldatarepositoryimpl">
<h3>TestResultLocalDataRepositoryImpl<a class="headerlink" href="#testresultlocaldatarepositoryimpl" title="Link to this heading"></a></h3>
<p>Implementation (<code class="docutils literal notranslate"><span class="pre">lib/app/features/user/domain/repository/test_result_local_data_repository.dart</span></code>):</p>
<ul class="simple">
<li><p>Implements TestResultLocalDataRepository interface:
* Delegates database operations to data source
* Converts between models and domain entities
* Manages test result storage and retrieval
* Performs reference code validation</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="domain.html" class="btn btn-neutral float-left" title="Domain Layer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../home/index.html" class="btn btn-neutral float-right" title="Home Module Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, xiaoyang peng.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>